# Лекция 2. Основы C#. Типы данных в C#

**Цель лекции:** Понять фундаментальные строительные блоки языка C#, изучить систему типов, научиться правильно выбирать типы данных для переменных.

---

### **План лекции:**

1.  **Введение в C# и .NET**
2.  **Понятие переменной**
3.  **Типы данных в C#**
    *   **3.1. Целочисленные типы**
    *   **3.2. Типы с плавающей запятой**
    *   **3.3. Логический тип**
    *   **3.4. Символьный тип**
    *   **3.5. Строковый тип**
    *   **3.6. Тип object**
    *   **3.7. Тип dynamic**
4.  **Категории типов: значимые (Value Types) и ссылочные (Reference Types)**
5.  **Неявная типизация (ключевое слово var)**
6.  **Преобразование типов**
    *   **6.1. Неявное преобразование**
    *   **6.2. Явное преобразование (каст)**
    *   **6.3. Использование методов Convert и Parse**
7.  **Резюме**
8.  **Контрольные вопросы**

---

### **1. Введение в C# и .NET**

C# (произносится "си шарп") – это современный, объектно-ориентированный и типобезопасный язык программирования, разработанный компанией Microsoft в рамках платформы .NET.

**Ключевые моменты:**
*   **.NET Platform:** Это платформа для запуска приложений. Ваш код на C# компилируется в промежуточный язык (IL), который затем выполняется в среде .NET (CLR - Common Language Runtime).
*   **Объектно-ориентированный:** Все сущности в C# являются объектами.
*   **Типобезопасный:** Компилятор гарантирует, что вы не сможете, например, присвоить строку переменной, предназначенной для чисел, без явного на то указания. Это предотвращает множество ошибок.

**Первый пример кода:**
```csharp
using System;

class Program
{
    static void Main()
    {
        Console.WriteLine("Hello, World!");
    }
}
```
*   `using System;` - подключение пространства имен для использования стандартных классов, like `Console`.
*   `class Program` - объявление класса.
*   `static void Main()` - главная точка входа в программу.
*   `Console.WriteLine(...)` - вывод текста на консоль.

### **2. Понятие переменной**

**Переменная** – это именованная область памяти, предназначенная для хранения данных определенного типа.

**Объявление и инициализация:**
```csharp
// Объявление переменной типа int с именем age
int age;

// Инициализация (первое присвоение значения)
age = 25;

// Объявление и инициализация в одной строке
string name = "Alice";
double height = 1.75;
```

### **3. Типы данных в C#**

Типы данных определяют:
*   Размер выделяемой памяти.
*   Диапазон возможных значений.
*   Допустимые операции.

#### **3.1. Целочисленные типы**

Хранят целые числа. Различаются по размеру и диапазону.

| Тип    | Размер | Диапазон                                     | Пример использования      |
|--------|--------|----------------------------------------------|---------------------------|
| `sbyte`| 1 байт | -128 до 127                                  | `sbyte temperature = -23;`|
| `byte` | 1 байт | 0 до 255                                     | `byte pixelValue = 200;`  |
| `short`| 2 байта| -32,768 до 32,767                            | `short population = 15000;`|
| `ushort`| 2 байта| 0 до 65,535                                  | `ushort year = 2024;`     |
| `int`  | 4 байта| -2.1*10^9 до 2.1*10^9                        | `int distance = 1000000;` |
| `uint` | 4 байта| 0 до 4.3*10^9                                | `uint ui = 4000000000;`   |
| `long` | 8 байт| -9.2*10^18 до 9.2*10^18                      | `long starsInGalaxy = 1000000000000L;` |
| `ulong`| 8 байт| 0 до 1.8*10^19                               | `ulong ul = 18000000000000000000UL;` |

**Важно:** Для `long` и `ulong` используйте суффиксы `L` и `UL` соответственно.

#### **3.2. Типы с плавающей запятой**

Хранят вещественные (дробные) числа.

| Тип     | Размер | Точность          | Пример использования          |
|---------|--------|-------------------|-------------------------------|
| `float` | 4 байта| ~6-9 знаков       | `float pi = 3.14f;`           |
| `double`| 8 байт | ~15-17 знаков     | `double atomicMass = 1.66053906660e-27;` |
| `decimal`| 16 байт| 28-29 знаков      | `decimal price = 29.99m;`     |

**Важно:** Для `float` используйте суффикс `f`, для `decimal` - суффикс `m`. `double` является типом по умолчанию для дробных чисел.

```csharp
float gravity = 9.81f;
double scientificValue = 1.23e-4; // 0.000123
decimal salary = 55000.75m; // Идеально для финансовых расчетов
```

#### **3.3. Логический тип (`bool`)**

Может содержать только два значения: `true` (истина) или `false` (ложь).

```csharp
bool isActive = true;
bool isEmpty = false;
bool isEqual = (5 > 3); // Результат сравнения - true
```

#### **3.4. Символьный тип (`char`)**

Хранит один символ в кодировке Unicode. Размер - 2 байта. Значения задаются в одинарных кавычках.

```csharp
char grade = 'A';
char symbol = '\u0061'; // Символ 'a' в Unicode
char newLine = '\n'; // Управляющий символ новой строки
```

#### **3.5. Строковый тип (`string`)**

Представляет последовательность символов. Значения задаются в двойных кавычках. **Важно:** `string` - ссылочный тип, но он обладает семантикой, похожей на значимый.

```csharp
string greeting = "Hello, World!";
string name = "John";
string multiline = @"Это
многострочная
строка";
string interpolated = $"Привет, {name}! Тебе {age} лет."; // Интерполяция строк
```

#### **3.6. Тип `object`**

Это базовый тип для всех других типов в .NET. Переменная типа `object` может хранить значение любого типа.

```csharp
object obj1 = 10;       // int
object obj2 = "Hello";  // string
object obj3 = 3.14;     // double

// Однако, чтобы работать с этими значениями по-своему, нужно привести их к родному типу.
int number = (int)obj1;
```

#### **3.7. Тип `dynamic`**

Введен для взаимодействия с динамическими языками. Компилятор пропускает проверку типов для `dynamic`. Тип проверяется во время выполнения (at runtime).

```csharp
dynamic dynamicVar = 10;
dynamicVar = "Теперь я строка"; // Ошибки на этапе компиляции не будет
dynamicVar.SomeMethod(); // Если метода не существует, ошибка возникнет при выполнении.
```

### **4. Категории типов: значимые (Value Types) и ссылочные (Reference Types)**

Это фундаментальное разделение в C#.

| Характеристика      | Значимые типы (Value Types)                  | Ссылочные типы (Reference Types)           |
|---------------------|----------------------------------------------|--------------------------------------------|
| **Хранение**        | Хранятся в стеке (stack)                     | Хранятся в управляемой куче (managed heap) |
| **Присвоение**      | Копируется значение                          | Копируется ссылка (адрес в памяти)         |
| **Поведение**       | Каждая переменная имеет свою копию данных    | Две переменные могут ссылаться на один объект |
| **Примеры**         | `int`, `double`, `bool`, `char`, `struct`    | `string`, `array`, `class`, `object`       |

**Пример для понимания:**
```csharp
// Значимый тип
int a = 10;
int b = a; // b получает КОПИЮ значения a (10)
b = 20;    // Изменяем b, a не меняется
Console.WriteLine(a); // Вывод: 10

// Ссылочный тип
int[] array1 = new int[] { 1, 2, 3 };
int[] array2 = array1; // array2 получает КОПИЮ ССЫЛКИ на тот же массив
array2[0] = 100;       // Изменяем данные через array2
Console.WriteLine(array1[0]); // Вывод: 100, потому что array1 и array2 указывают на один объект
```

### **5. Неявная типизация (ключевое слово `var`)**

Ключевое слово `var` позволяет объявить переменную без явного указания типа. Компилятор сам определяет тип на основе присваиваемого значения.

```csharp
var number = 42;        // компилятор определяет number как int
var text = "C#";        // компилятор определяет text как string
var pi = 3.14;          // компилятор определяет pi как double
var isEnabled = true;   // компилятор определяет isEnabled как bool

// var error; // ОШИБКА! Переменная var должна быть сразу инициализирована.
```

**Важно:** `var` - это не тип "как в JavaScript". Это синтаксический сахар. Тип фиксируется на этапе компиляции и потом изменить его нельзя.
```csharp
var x = 10;
x = "Hello"; // Ошибка компиляции! Тип x уже int.
```

### **6. Преобразование типов**

#### **6.1. Неявное преобразование**

Выполняется компилятором автоматически, когда нет риска потери данных (обычно из типа с меньшим диапазоном в тип с большим).

```csharp
int smallNumber = 100;
long bigNumber = smallNumber; // Неявное преобразование int -> long

float myFloat = 12.5f;
double myDouble = myFloat;    // Неявное преобразование float -> double

int i = 10;
double d = i; // Неявное преобразование int -> double (результат 10.0)
```

#### **6.2. Явное преобразование (каст)**

Требуется, когда есть риск потери данных. Выполняется с помощью оператора `(тип)`.

```csharp
double d = 12.78;
int i = (int)d; // Явное преобразование double -> int. Дробная часть отбрасывается.
Console.WriteLine(i); // Вывод: 12

long l = 5000;
int j = (int)l; // OK, т.к. 5000 влезает в int

long bigValue = 9_000_000_000; // 9 миллиардов
int smallValue = (int)bigValue; // Риск! Число не влезает в int. Результат будет некорректным.
```

#### **6.3. Использование методов Convert и Parse**

**Класс `Convert`:** Содержит методы для преобразования в базовые типы.
```csharp
string input = "123";
int number = Convert.ToInt32(input); // number = 123

double d = 55.99;
int rounded = Convert.ToInt32(d); // Округляет! rounded = 56
```

**Методы `Parse` и `TryParse`:** Преобразуют строку в соответствующий тип.
```csharp
string numStr = "777";
int parsedNumber = int.Parse(numStr); // parsedNumber = 777

// Parse выбросит исключение, если строка невалидна.
// Безопаснее использовать TryParse.
string invalidStr = "hello";
bool success = int.TryParse(invalidStr, out int result);
if (success)
{
    Console.WriteLine($"Успешно: {result}");
}
else
{
    Console.WriteLine("Ошибка преобразования!"); // Выполнится эта ветка
}
```

### **7. Резюме**

*   **C#** - строго типизированный язык, работающий на платформе **.NET**.
*   **Переменная** - это именованная ячейка памяти для хранения данных.
*   Каждая переменная имеет **тип**, который определяет размер, диапазон и операции.
*   Мы изучили основные **встроенные типы данных**: целочисленные (`int`, `long`), с плавающей запятой (`float`, `double`, `decimal`), логический (`bool`), символьный (`char`) и строковый (`string`).
*   Типы делятся на **значимые** (хранятся в стеке, копируется значение) и **ссылочные** (хранятся в куче, копируется ссылка).
*   Ключевое слово **`var`** позволяет использовать неявную типизацию, но тип определяется на этапе компиляции.
*   **Преобразование типов** бывает неявным (безопасным) и явным (с риском потери данных). Для работы со строками используйте `Convert`, `Parse` и `TryParse`.

Правильный выбор типа данных критически важен для производительности, потребления памяти и корректности программы.

### **8. Контрольные вопросы**

1.  В чем основное различие между значимыми и ссылочными типами? Где они хранятся в памяти?
2.  Какой целочисленный тип вы выберете для хранения возраста человека? А для хранения населения Земли? Обоснуйте свой выбор.
3.  В чем разница между типами `float`, `double` и `decimal`? Для каких задач лучше подходит каждый из них?
4.  Что выведет следующий код и почему?
    ```csharp
    int a = 5;
    int b = a;
    b = 10;
    Console.WriteLine(a);
    ```
5.  Что выведет следующий код и почему?
    ```csharp
    int[] arr1 = { 1, 2, 3 };
    int[] arr2 = arr1;
    arr2[0] = 100;
    Console.WriteLine(arr1[0]);
    ```
6.  Объясните, в чем разница между `int.Parse()` и `int.TryParse()`. Какой метод безопаснее и почему?
7.  Какая ошибка есть в этом коде? Как ее исправить?
    ```csharp
    float price = 19.99;
    ```
8.  Можно ли изменить тип переменной, объявленной с помощью `var`, после ее инициализации? Почему?
9.  Чем тип `dynamic` принципиально отличается от `object`?
10. Что произойдет при выполнении следующего явного преобразования? Будет ли ошибка?
    ```csharp
    double largeNumber = 999.99;
    byte smallNumber = (byte)largeNumber;
    Console.WriteLine(smallNumber);
    ```