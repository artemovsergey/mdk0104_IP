# Практическая работа 17. Сравнение производительности последовательного, параллельного и асинхронного кода на примере обработки данных

Изучение различий в производительности между последовательным, параллельным и асинхронным выполнением операций обработки данных в .NET

## Цель

Научить студентов:

1. Понимать различия между последовательным, параллельным и асинхронным кодом.
2. Реализовывать примеры последовательной, параллельной и асинхронной обработки данных.
3. Измерять и сравнивать время выполнения разных подходов.
4. Оптимизировать код для повышения производительности.

---

## Теоретическая часть

### 1. Последовательный код

Последовательный код выполняется **строка за строкой**, каждая операция завершает выполнение до начала следующей. Этот подход прост в реализации, но может быть медленным при обработке больших массивов данных или при ожидании ввода/вывода.

Пример: обработка списка чисел с задержкой для симуляции работы:

```csharp
foreach (var item in data)
{
    Process(item); // занимает время
}
```

### 2. Параллельный код

Параллельный код использует **многопоточность**, позволяя нескольким операциям выполняться одновременно на разных ядрах процессора. В .NET для этого используется:

* `Parallel.For`
* `Parallel.ForEach`
* `Task.Run` для запуска отдельных задач

Пример:

```csharp
Parallel.ForEach(data, item =>
{
    Process(item);
});
```

Параллельные операции ускоряют процесс при многопоточной обработке CPU-bound задач.

### 3. Асинхронный код

Асинхронный код позволяет **не блокировать основной поток**, особенно эффективен при I/O-bound операциях (чтение/запись файлов, запросы к сети). Используется `async/await`:

```csharp
foreach (var item in data)
{
    await ProcessAsync(item);
}
```

Асинхронность повышает отзывчивость приложения, но не ускоряет CPU-bound операции.

### 4. Измерение производительности

В .NET для измерения времени выполнения используется класс `Stopwatch` из пространства `System.Diagnostics`:

```csharp
var stopwatch = Stopwatch.StartNew();
// код для измерения
stopwatch.Stop();
Console.WriteLine($"Время выполнения: {stopwatch.ElapsedMilliseconds} ms");
```

---

## Ход работы

1. Создать новый проект C# (.NET Console Application).
2. Реализовать последовательную обработку данных (например, числа, строки, массивы).
3. Реализовать параллельную обработку данных с использованием `Parallel.ForEach`.
4. Реализовать асинхронную обработку данных с использованием `async/await`.
5. Измерить и сравнить время выполнения каждого подхода с использованием `Stopwatch`.
6. Провести тестирование на разных объемах данных.
7. Проанализировать результаты и сделать выводы о производительности.
8. Сделать скриншоты работы программы и положить их в папку `images`.
9. Подготовить `readme.md` с номером работы, вариантом, текстом задания и кодом с подсветкой.

---

## Практический пример

Пример обработки массива чисел с задержкой, последовательный и параллельный подход:

```csharp
using System;
using System.Diagnostics;
using System.Threading;
using System.Threading.Tasks;
using System.Collections.Generic;
using System.Linq;

class Program
{
    static void Main()
    {
        var data = Enumerable.Range(1, 100).ToList();

        // Последовательная обработка
        Stopwatch sw = Stopwatch.StartNew();
        foreach (var item in data)
        {
            Process(item);
        }
        sw.Stop();
        Console.WriteLine($"Последовательно: {sw.ElapsedMilliseconds} ms");

        // Параллельная обработка
        sw.Restart();
        Parallel.ForEach(data, item =>
        {
            Process(item);
        });
        sw.Stop();
        Console.WriteLine($"Параллельно: {sw.ElapsedMilliseconds} ms");

        // Асинхронная обработка
        sw.Restart();
        Task.Run(async () =>
        {
            foreach (var item in data)
            {
                await ProcessAsync(item);
            }
        }).GetAwaiter().GetResult();
        sw.Stop();
        Console.WriteLine($"Асинхронно: {sw.ElapsedMilliseconds} ms");
    }

    static void Process(int value)
    {
        Thread.Sleep(50); // имитация работы
    }

    static async Task ProcessAsync(int value)
    {
        await Task.Delay(50); // имитация асинхронной работы
    }
}
```

---

## 15 вариантов простых заданий

Вариант выбирается по номеру в журнале:

1. Обработать массив чисел, вывести их квадраты последовательно, параллельно и асинхронно.
2. Обработать массив строк, преобразовав все буквы в верхний регистр.
3. Суммировать массив чисел разными способами.
4. Найти максимальное число в массиве.
5. Подсчитать количество четных чисел.
6. Преобразовать список дат в строки формата `yyyy-MM-dd`.
7. Обработать массив объектов, выводя их свойства.
8. Симулировать длительные операции с задержкой 100 мс.
9. Обработать список файлов, имитируя чтение каждого файла.
10. Преобразовать текстовый массив в JSON-строки.
11. Найти среднее значение массива чисел.
12. Создать таблицу умножения для чисел от 1 до N.
13. Обработать список пользовательских объектов с разными свойствами.
14. Сравнить время обработки для разного количества элементов (50, 100, 200).
15. Провести эксперимент: последовательная vs параллельная обработка I/O-bound задач (например, `Task.Delay`).

---

## Критерии оценки

| Оценка | Критерий                                                                                                                                                |
| ------ | ------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 2      | Программа частично работает, не выполняет все виды обработки.                                                                                           |
| 3      | Программа корректно выполняет одну или две обработки, выводит результаты.                                                                               |
| 4      | Программа корректно выполняет все три вида обработки, код читаем, есть замеры времени.                                                                  |
| 5      | Программа полностью соответствует заданию, есть вывод сравнительных графиков или таблиц, код структурирован, есть комментарии, скриншоты и `readme.md`. |

---

## Контрольные вопросы

1. Чем отличается последовательный код от параллельного?
2. Чем отличается асинхронный код от параллельного?
3. Для каких задач эффективен параллельный код?
4. Для каких задач эффективен асинхронный код?
5. Как измерить время выполнения кода в .NET?
6. Как запустить асинхронный метод в `Main`?
7. Какие ограничения есть у `Parallel.ForEach`?
8. Как избежать блокировки UI-потока при асинхронной обработке?

---

## Структура репозитория

```
Практическая_работа_17/
├─ PerformanceApp/               # Проект C# (.NET Console Application)
│   ├─ Program.cs
│   └─ ... (другие файлы проекта)
├─ images/                        # Скриншоты работы программы
│   ├─ screenshot1.png
│   └─ screenshot2.png
└─ readme.md                      # Описание работы
```

---

## Содержание файла `readme.md` (пример)

````markdown
# Практическая работа 17
## Сравнение производительности последовательного, параллельного и асинхронного кода
### Вариант: 2
**Задание:** Обработать массив чисел от 1 до 100, вывести их квадраты последовательно, параллельно и асинхронно. Сравнить время выполнения.

### Пример кода:

```csharp
using System;
using System.Diagnostics;
using System.Threading;
using System.Threading.Tasks;
using System.Linq;
using System.Collections.Generic;

class Program
{
    static void Main()
    {
        var data = Enumerable.Range(1, 100).ToList();
        Stopwatch sw = Stopwatch.StartNew();

        // Последовательно
        foreach (var item in data) Thread.Sleep(10); // имитация работы
        sw.Stop();
        Console.WriteLine($"Последовательно: {sw.ElapsedMilliseconds} ms");

        // Параллельно
        sw.Restart();
        Parallel.ForEach(data, item => Thread.Sleep(10));
        sw.Stop();
        Console.WriteLine($"Параллельно: {sw.ElapsedMilliseconds} ms");

        // Асинхронно
        sw.Restart();
        Task.Run(async () =>
        {
            foreach (var item in data) await Task.Delay(10);
        }).GetAwaiter().GetResult();
        sw.Stop();
        Console.WriteLine($"Асинхронно: {sw.ElapsedMilliseconds} ms");
    }
}
````

```
