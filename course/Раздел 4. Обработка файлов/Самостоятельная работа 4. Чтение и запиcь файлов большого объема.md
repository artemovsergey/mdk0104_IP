# Самостоятельная работа 4. Чтение и запись файлов большого объема

### Цель работы

Научиться эффективно работать с файлами большого объёма в C#. Освоить методы построчного чтения, буферизации, потоковой записи, асинхронного чтения и записи, а также оценить производительность различных подходов.

---

## **Теоретическая часть**

1. **Работа с файловыми потоками**

   * В .NET для работы с файлами используются классы пространства имён `System.IO`:

     * `FileStream` — низкоуровневый доступ к файлу (чтение/запись байтов).
     * `StreamReader` / `StreamWriter` — построчное чтение и запись текстовых файлов.
     * `BinaryReader` / `BinaryWriter` — работа с бинарными данными.
     * `File` / `FileInfo` — статические методы и объектная модель для управления файлами.

2. **Чтение больших файлов**

   * Следует использовать **стримы (потоки)** вместо методов вроде `File.ReadAllText()`, чтобы не загружать файл целиком в память.

   ```csharp
   using (var reader = new StreamReader("data.txt"))
   {
       string? line;
       while ((line = reader.ReadLine()) != null)
       {
           Console.WriteLine(line);
       }
   }
   ```

3. **Запись больших файлов**

   * Используется `StreamWriter` с буферизацией:

   ```csharp
   using (var writer = new StreamWriter("output.txt"))
   {
       for (int i = 0; i < 1000000; i++)
           writer.WriteLine($"Line {i}");
   }
   ```

4. **Асинхронная работа с файлами**

   * Методы `ReadLineAsync()` и `WriteLineAsync()` позволяют не блокировать поток:

   ```csharp
   using (var writer = new StreamWriter("async_output.txt"))
   {
       for (int i = 0; i < 1000000; i++)
           await writer.WriteLineAsync($"Async line {i}");
   }
   ```

5. **Буферизация и производительность**

   * Буферизация уменьшает количество обращений к диску, улучшая скорость обработки больших файлов.
   * Можно настраивать размер буфера в конструкторе:

   ```csharp
   new StreamReader("file.txt", Encoding.UTF8, true, bufferSize: 8192);
   ```

---

## **Ход работы**

1. Создать консольный проект `BigFileIO`.
2. Реализовать:

   * Генерацию текстового файла объёмом не менее 50 МБ.
   * Построчное чтение данных с подсчётом строк и времени выполнения.
   * Асинхронную запись другого файла с использованием `StreamWriter.WriteLineAsync()`.
   * Сравнение времени синхронной и асинхронной записи.
3. Вывести результаты в консоль:

   * Количество строк
   * Время чтения/записи (в секундах)
4. Сделать скриншоты работы программы и добавить в папку `images`.
5. Создать файл `readme.md` с описанием и примерами кода.

---

## **Пример реализации**

```csharp
using System;
using System.Diagnostics;
using System.IO;
using System.Text;
using System.Threading.Tasks;

class Program
{
    static async Task Main()
    {
        string bigFile = "bigdata.txt";
        string copyFile = "copy_async.txt";

        // Генерация большого файла (50 МБ+)
        Console.WriteLine("Генерация файла...");
        using (var writer = new StreamWriter(bigFile, false, Encoding.UTF8, 8192))
        {
            for (int i = 0; i < 5_000_000; i++)
                writer.WriteLine($"Строка номер {i}");
        }

        Console.WriteLine("Файл создан.");

        // Чтение файла
        Console.WriteLine("\nЧтение файла...");
        var swRead = Stopwatch.StartNew();
        int count = 0;

        using (var reader = new StreamReader(bigFile))
        {
            while (await reader.ReadLineAsync() != null)
                count++;
        }

        swRead.Stop();
        Console.WriteLine($"Прочитано {count} строк за {swRead.Elapsed.TotalSeconds:F2} сек.");

        // Асинхронная запись файла
        Console.WriteLine("\nАсинхронная запись файла...");
        var swWrite = Stopwatch.StartNew();

        using (var reader = new StreamReader(bigFile))
        using (var writer = new StreamWriter(copyFile))
        {
            string? line;
            while ((line = await reader.ReadLineAsync()) != null)
                await writer.WriteLineAsync(line);
        }

        swWrite.Stop();
        Console.WriteLine($"Файл записан асинхронно за {swWrite.Elapsed.TotalSeconds:F2} сек.");
    }
}
```

---

## **Критерии оценки**

| Оценка | Критерий                                                                                       |
| ------ | ---------------------------------------------------------------------------------------------- |
| 2      | Программа частично работает, большие файлы не обрабатываются корректно                         |
| 3      | Реализовано чтение и запись файла большого объёма, но без асинхронности                        |
| 4      | Реализовано чтение и запись, применена асинхронность, корректные результаты                    |
| 5      | Полноценная реализация с измерением времени, комментариями, чистым кодом, скриншотами и readme |

---

## **Контрольные вопросы**

1. Чем отличается `File.ReadAllText()` от `StreamReader` при работе с большими файлами?
2. Для чего нужна буферизация при работе с файлами?
3. В чём преимущества асинхронной записи данных?
4. Как измерить производительность операций чтения и записи?
5. Как избежать переполнения памяти при обработке больших файлов?

---

## **Структура репозитория**

```
BigFileIO/
│
├── BigFileIO.sln
├── BigFileIO/
│   ├── Program.cs
│   └── BigFileIO.csproj
│
├── images/
│   ├── generate.png
│   ├── read.png
│   └── write.png
│
└── readme.md
```

---

### **Пример readme.md**

````markdown
# Самостоятельная работа №4

**Тема:** Чтение и запись файлов большого объема  

## Цель
Освоить эффективные методы чтения и записи файлов большого размера в C#.

## Задание
1. Сгенерировать файл объёмом не менее 50 МБ.
2. Реализовать построчное чтение с подсчётом строк и временем выполнения.
3. Реализовать асинхронную запись копии файла.
4. Сравнить производительность синхронной и асинхронной записи.

## Пример кода
```csharp
// Фрагмент кода для чтения и записи приведен в Program.cs
````

## Результат

Скриншоты работы программы приведены в папке `/images`.

```