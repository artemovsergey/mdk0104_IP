# Практическая работа 18. Подходы CodeFirst и DatabaseFirst

Изучение подходов **CodeFirst** и **DatabaseFirst** при работе с Entity Framework Core и их применение для создания и работы с базой данных в .NET.

### Цель:

* Ознакомиться с основными подходами работы с базой данных в EF Core.
* Научиться создавать модели данных и контексты DbContext.
* Практически реализовать CRUD-операции в проекте.
* Сравнить преимущества и недостатки подходов CodeFirst и DatabaseFirst.

---

## Теоретическая часть

### 1. Подход CodeFirst

* Сначала создаются **классы моделей** в C#, затем база данных создается на их основе.
* Поддерживается через **миграции** (`dotnet ef migrations add`, `dotnet ef database update`).
* Удобен для новых проектов, когда база данных еще не создана.
* Пример класса сущности:

```csharp
public class Product
{
    public int Id { get; set; }
    public string Name { get; set; }
    public decimal Price { get; set; }
}
```

### 2. Подход DatabaseFirst

* Сначала существует **готовая база данных**, на основе которой EF Core генерирует классы моделей.
* Используется команда `Scaffold-DbContext` или `dotnet ef dbcontext scaffold`.
* Удобен для работы с уже существующими системами.
* Пример команды генерации моделей из базы данных SQL Server:

```bash
dotnet ef dbcontext scaffold "Server=.;Database=ShopDb;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -o Models
```

### 3. Отличия подходов

| Характеристика  | CodeFirst           | DatabaseFirst                    |
| --------------- | ------------------- | -------------------------------- |
| Начало работы   | Создание моделей C# | Существующая база данных         |
| Изменения схемы | Через миграции      | Через обновление базы и Scaffold |
| Подходит для    | Новых проектов      | Существующих баз данных          |
| Контроль схемы  | Полный              | Ограниченный                     |

---

## Ход работы

1. Выбрать вариант задания по номеру в журнале.
2. Создать новый проект .NET (консольное или WinForms приложение).
3. Реализовать подход CodeFirst или DatabaseFirst в зависимости от задания.
4. Создать модель(и) данных и контекст DbContext.
5. Выполнить CRUD-операции с сущностями.
6. Сделать скриншоты работы программы и положить их в папку `images`.
7. Создать файл `readme.md` с номером практической работы, вариантом, текстом задания и оформленным кодом.
8. Сохранить проект в репозиторий.

---

## Практический пример (CodeFirst)

**Шаг 1. Создание моделей:**

```csharp
public class Customer
{
    public int Id { get; set; }
    public string FullName { get; set; }
    public string Email { get; set; }
    public ICollection<Order> Orders { get; set; }
}

public class Order
{
    public int Id { get; set; }
    public int CustomerId { get; set; }
    public Customer Customer { get; set; }
    public DateTime OrderDate { get; set; }
}
```

**Шаг 2. Создание DbContext:**

```csharp
public class ShopContext : DbContext
{
    public DbSet<Customer> Customers { get; set; }
    public DbSet<Order> Orders { get; set; }

    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
        optionsBuilder.UseSqlServer("Server=.;Database=ShopDb;Trusted_Connection=True;");
    }
}
```

**Шаг 3. Создание миграции и базы данных:**

```bash
dotnet ef migrations add InitialCreate
dotnet ef database update
```

**Шаг 4. CRUD-операции:**

```csharp
using var context = new ShopContext();

// Создание клиента
var customer = new Customer { FullName = "Alice", Email = "alice@example.com" };
context.Customers.Add(customer);
context.SaveChanges();

// Чтение клиентов
var customers = context.Customers.ToList();

// Обновление клиента
customer.FullName = "Alice Smith";
context.SaveChanges();

// Удаление клиента
context.Customers.Remove(customer);
context.SaveChanges();
```

---

## 15 вариантов простых заданий

1. Создать базу данных продуктов с полями Id, Name, Price (CodeFirst).
2. Создать таблицу заказов с полями Id, CustomerName, OrderDate (CodeFirst).
3. Создать сущность `Student` с полями Id, Name, Age (CodeFirst).
4. Создать таблицу `Teacher` и сгенерировать модели через DatabaseFirst.
5. Создать сущность `Course` с полями Id, Title, Description (CodeFirst).
6. Создать таблицу `Department` и сгенерировать модели через DatabaseFirst.
7. Реализовать связь один-ко-многим между Customer и Order (CodeFirst).
8. Создать сущность `Book` и выполнить CRUD-операции (CodeFirst).
9. Создать таблицу `Library` и сгенерировать модели через DatabaseFirst.
10. Реализовать связь многие-ко-многим между Student и Course (CodeFirst).
11. Создать сущность `Employee` с полями Id, Name, Salary (CodeFirst).
12. Создать таблицу `Project` и сгенерировать модели через DatabaseFirst.
13. Реализовать связь один-к-одному между User и Profile (CodeFirst).
14. Создать сущность `ProductCategory` с полями Id, Name (CodeFirst).
15. Создать таблицу `Invoice` и сгенерировать модели через DatabaseFirst.

---

## Критерии оценки

| Оценка | Критерий                                                                                                     |
| ------ | ------------------------------------------------------------------------------------------------------------ |
| 5      | Полное выполнение задания, корректная работа CRUD, соблюдение структуры проекта, наличие скриншотов и readme |
| 4      | Задание выполнено с небольшими недочетами, CRUD работает частично, есть readme и скриншоты                   |
| 3      | Задание выполнено, но есть ошибки или пропущены элементы (скриншоты, readme)                                 |
| 2      | Работа выполнена частично, CRUD не работает, нет readme или скриншотов                                       |
| 1      | Работа не сдана или не запускается                                                                           |

---

## Контрольные вопросы

1. В чем отличие подходов CodeFirst и DatabaseFirst?
2. Как создать DbContext для проекта CodeFirst?
3. Какие команды используются для создания миграции и обновления базы данных?
4. Как сгенерировать модели из существующей базы данных?
5. Какие CRUD-операции можно выполнять с помощью EF Core?
6. Как реализовать связь один-ко-многим между сущностями?
7. Как включить логирование SQL-запросов в EF Core?
8. Как подключить проект к SQL Server и SQLite?
9. В чем преимущество использования миграций в CodeFirst?
10. Какие файлы должны быть включены в репозиторий при сдаче работы?

---

## Структура репозитория

```
ПрактическаяРабота16/
│
├─ Project/                 # Проект приложения (ConsoleApp или WinForms)
│
├─ images/                  # Скриншоты работы программы
│
└─ readme.md                # Информация о работе, вариант, текст задания, код
```

**Пример readme.md:**

````markdown
# Практическая работа №16
## Тема: Подходы CodeFirst и DatabaseFirst
### Вариант 3

**Задание:** Создать сущность `Student` с полями Id, Name, Age. Реализовать CRUD-операции.

```csharp
public class Student
{
    public int Id { get; set; }
    public string Name { get; set; }
    public int Age { get; set; }
}
````

```csharp
using var context = new AppDbContext();
var student = new Student { Name = "John", Age = 20 };
context.Students.Add(student);
context.SaveChanges();
```

```