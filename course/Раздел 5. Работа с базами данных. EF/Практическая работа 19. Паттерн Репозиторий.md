# Практическая работа 19. Паттерн Репозиторий

Изучение и применение паттерна **Repository** при работе с базой данных в проектах .NET с использованием EF Core.

### Цель:

* Ознакомиться с концепцией паттерна «Репозиторий».
* Научиться абстрагировать работу с базой данных через интерфейсы репозиториев.
* Реализовать CRUD-операции через репозитории.
* Сравнить работу с базой напрямую через DbContext и через репозиторий.

---

## Теоретическая часть

### 1. Что такое паттерн Репозиторий

Паттерн «Репозиторий» — это структурный шаблон проектирования, который абстрагирует слой доступа к данным. Основная идея:

* Скрыть детали работы с базой данных (SQL-запросы, ORM, подключения).
* Предоставить единый интерфейс для работы с коллекцией объектов.
* Обеспечить возможность легко тестировать бизнес-логику, не затрагивая базу данных.

**Пример интерфейса репозитория:**

```csharp
public interface IRepository<T> where T : class
{
    IEnumerable<T> GetAll();
    T GetById(int id);
    void Add(T entity);
    void Update(T entity);
    void Delete(T entity);
}
```

---

### 2. Преимущества паттерна Репозиторий

* Снижение связности между слоями приложения.
* Унификация доступа к данным.
* Возможность реализации Unit of Work поверх репозиториев.
* Упрощение тестирования (можно использовать заглушки).

### 3. Состав репозитория

Репозиторий обычно включает:

* **Интерфейс (IRepository<T>)** — определяет стандартные методы CRUD.
* **Реализация (Repository<T>)** — конкретная реализация через DbContext.
* **Специализированные репозитории (например, ProductRepository)** — расширяют стандартные методы для конкретной сущности.

---

## Ход работы

1. Выбрать вариант задания по номеру в журнале.
2. Создать новый проект .NET (консольный, WinForms или ASP.NET Core).
3. Создать модели сущностей (например, Product, Customer, Order).
4. Создать интерфейс `IRepository<T>` и его реализацию.
5. Создать специализированные репозитории (по желанию).
6. Реализовать CRUD-операции через репозитории.
7. Сравнить работу через DbContext напрямую и через репозиторий.
8. Сделать скриншоты работы программы и поместить их в папку `images`.
9. Создать файл `readme.md` с номером практической работы, вариантом, текстом задания и оформленным кодом.
10. Сохранить проект в репозиторий.

---

## Практический пример

**1. Модель сущности:**

```csharp
public class Product
{
    public int Id { get; set; }
    public string Name { get; set; }
    public decimal Price { get; set; }
}
```

**2. DbContext:**

```csharp
public class AppDbContext : DbContext
{
    public DbSet<Product> Products { get; set; }

    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
        optionsBuilder.UseSqlServer("Server=.;Database=ShopDb;Trusted_Connection=True;");
    }
}
```

**3. Интерфейс репозитория:**

```csharp
public interface IRepository<T> where T : class
{
    IEnumerable<T> GetAll();
    T GetById(int id);
    void Add(T entity);
    void Update(T entity);
    void Delete(T entity);
}
```

**4. Реализация репозитория:**

```csharp
public class Repository<T> : IRepository<T> where T : class
{
    private readonly AppDbContext _context;
    private readonly DbSet<T> _dbSet;

    public Repository(AppDbContext context)
    {
        _context = context;
        _dbSet = context.Set<T>();
    }

    public IEnumerable<T> GetAll() => _dbSet.ToList();
    public T GetById(int id) => _dbSet.Find(id);
    public void Add(T entity)
    {
        _dbSet.Add(entity);
        _context.SaveChanges();
    }
    public void Update(T entity)
    {
        _dbSet.Update(entity);
        _context.SaveChanges();
    }
    public void Delete(T entity)
    {
        _dbSet.Remove(entity);
        _context.SaveChanges();
    }
}
```

**5. Использование репозитория:**

```csharp
using var context = new AppDbContext();
IRepository<Product> productRepo = new Repository<Product>(context);

// Добавление продукта
var product = new Product { Name = "Laptop", Price = 1500 };
productRepo.Add(product);

// Получение всех продуктов
var products = productRepo.GetAll();

// Обновление продукта
product.Price = 1400;
productRepo.Update(product);

// Удаление продукта
productRepo.Delete(product);
```

---

## 15 вариантов заданий

1. Создать репозиторий для сущности `Product` и реализовать CRUD-операции.
2. Создать репозиторий для сущности `Customer` с полями Id, Name, Email.
3. Реализовать репозиторий для сущности `Order` с полями Id, OrderDate, CustomerId.
4. Создать специализированный репозиторий `ProductRepository` с методом поиска по цене.
5. Создать репозиторий `Student` с полями Id, Name, Age и CRUD-операциями.
6. Реализовать репозиторий `Teacher` с полями Id, Name, Subject.
7. Создать репозиторий `Course` и добавить метод для получения всех курсов по студенту.
8. Создать репозиторий `Invoice` с методом поиска по дате.
9. Реализовать репозиторий `Book` с методом получения книг по автору.
10. Создать репозиторий `Library` с методом поиска по жанру.
11. Создать репозиторий `Employee` с методом получения сотрудников по отделу.
12. Создать репозиторий `Project` с методами для добавления и удаления проектов.
13. Создать репозиторий `User` с полями Id, Username, Password и метод проверки логина.
14. Создать репозиторий `Profile` и связать его один-к-одному с `User`.
15. Создать репозиторий `ProductCategory` и реализовать метод получения всех продуктов категории.

---

## Критерии оценки

| Оценка | Критерий                                                                                                                          |
| ------ | --------------------------------------------------------------------------------------------------------------------------------- |
| 5      | Полное выполнение задания, корректная реализация репозитория, CRUD работает, структура проекта соблюдена, есть скриншоты и readme |
| 4      | Задание выполнено с незначительными недочетами, CRUD работает частично, есть readme и скриншоты                                   |
| 3      | Работа выполнена, но есть ошибки или отсутствуют элементы (скриншоты или readme)                                                  |
| 2      | Работа выполнена частично, CRUD не работает, нет readme или скриншотов                                                            |
| 1      | Работа не сдана или проект не запускается                                                                                         |

---

## Контрольные вопросы

1. Что такое паттерн Репозиторий и зачем он нужен?
2. В чем отличие работы с DbContext напрямую и через репозиторий?
3. Какие методы стандартного репозитория должны быть реализованы?
4. Как создать специализированный репозиторий для конкретной сущности?
5. Какие преимущества дает паттерн Репозиторий при тестировании приложения?
6. Как внедрить репозиторий через Dependency Injection?
7. Как реализовать поиск по определенному полю через репозиторий?
8. Можно ли использовать один репозиторий для нескольких DbSet?
9. Чем репозиторий упрощает поддержку и расширение кода?
10. Какие файлы должны быть включены в репозиторий при сдаче работы?

---

## Структура репозитория

```
ПрактическаяРабота19/
│
├─ Project/                  # Проект приложения (ConsoleApp, WinForms, ASP.NET Core)
│
├─ images/                   # Скриншоты работы программы
│
└─ readme.md                 # Номер работы, вариант, текст задания, пример кода
```

**Пример readme.md:**

````markdown
# Практическая работа №19
## Тема: Паттерн Репозиторий
### Вариант 4

**Задание:** Создать репозиторий для сущности `Order` с полями Id, OrderDate, CustomerId. Реализовать CRUD-операции.

```csharp
public class Order
{
    public int Id { get; set; }
    public DateTime OrderDate { get; set; }
    public int CustomerId { get; set; }
}
````

```csharp
using var context = new AppDbContext();
IRepository<Order> orderRepo = new Repository<Order>(context);
var order = new Order { OrderDate = DateTime.Now, CustomerId = 1 };
orderRepo.Add(order);
```

```
