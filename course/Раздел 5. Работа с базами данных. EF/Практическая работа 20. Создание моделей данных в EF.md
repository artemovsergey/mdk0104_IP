# Практическая работа 20. Создание моделей данных в Entity Framework

Создание и настройка моделей данных в **Entity Framework Core** для работы с базой данных в проектах .NET.

### Цель:

* Ознакомиться с концепцией моделей данных в EF Core.
* Научиться создавать сущности и контексты DbContext.
* Реализовать базовые CRUD-операции с использованием моделей данных.
* Практически применять атрибуты Data Annotations и Fluent API для конфигурации моделей.

---

## Теоретическая часть

### 1. Модели данных в EF Core

Модель данных — это объектное представление таблиц и связей базы данных в C#. Каждая сущность (`Entity`) соответствует таблице, а свойства класса — колонкам.

**Пример сущности:**

```csharp
public class Product
{
    public int Id { get; set; } // Первичный ключ
    public string Name { get; set; }
    public decimal Price { get; set; }
}
```

### 2. Контекст базы данных (DbContext)

`DbContext` — основной класс для работы с EF Core. Он обеспечивает:

* Подключение к базе данных;
* Управление сущностями через DbSet;
* Отслеживание изменений (Change Tracking);
* Выполнение CRUD-операций и LINQ-запросов.

**Пример контекста:**

```csharp
public class AppDbContext : DbContext
{
    public DbSet<Product> Products { get; set; }

    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
        optionsBuilder.UseSqlServer("Server=.;Database=ShopDb;Trusted_Connection=True;");
    }
}
```

### 3. Конфигурация моделей

Модели можно конфигурировать двумя способами:

1. **Data Annotations (атрибуты):**

```csharp
public class Customer
{
    [Key]
    public int Id { get; set; }

    [Required]
    [MaxLength(100)]
    public string FullName { get; set; }

    [EmailAddress]
    public string Email { get; set; }
}
```

2. **Fluent API (в методе OnModelCreating):**

```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    modelBuilder.Entity<Customer>()
        .Property(c => c.FullName)
        .IsRequired()
        .HasMaxLength(100);

    modelBuilder.Entity<Customer>()
        .HasIndex(c => c.Email)
        .IsUnique();
}
```

---

## Ход работы

1. Выбрать вариант задания по номеру в журнале.
2. Создать новый проект .NET (консольное или WinForms приложение).
3. Создать сущности в виде классов.
4. Настроить DbContext с DbSet для каждой сущности.
5. При необходимости применить Data Annotations или Fluent API для конфигурации.
6. Создать миграцию и обновить базу данных (для подхода CodeFirst).
7. Реализовать CRUD-операции с созданными моделями.
8. Сделать скриншоты работы программы и положить их в папку `images`.
9. Создать файл `readme.md` с номером практической работы, вариантом, текстом задания и оформленным кодом.
10. Сохранить проект в репозиторий.

---

## Практический пример

**1. Создание сущности `Product`:**

```csharp
public class Product
{
    public int Id { get; set; }
    public string Name { get; set; }
    public decimal Price { get; set; }
}
```

**2. Создание DbContext:**

```csharp
public class ShopContext : DbContext
{
    public DbSet<Product> Products { get; set; }

    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
        optionsBuilder.UseSqlServer("Server=.;Database=ShopDb;Trusted_Connection=True;");
    }
}
```

**3. Создание миграции и базы данных:**

```bash
dotnet ef migrations add InitialCreate
dotnet ef database update
```

**4. CRUD-операции с моделью:**

```csharp
using var context = new ShopContext();

// Создание
var product = new Product { Name = "Laptop", Price = 1500 };
context.Products.Add(product);
context.SaveChanges();

// Чтение
var products = context.Products.ToList();

// Обновление
product.Price = 1400;
context.SaveChanges();

// Удаление
context.Products.Remove(product);
context.SaveChanges();
```

---

## 15 вариантов заданий

1. Создать модель `Product` с полями Id, Name, Price.
2. Создать модель `Customer` с полями Id, FullName, Email.
3. Создать модель `Order` с полями Id, CustomerId, OrderDate.
4. Создать модель `Student` с полями Id, Name, Age.
5. Создать модель `Teacher` с полями Id, Name, Subject.
6. Создать модель `Course` с полями Id, Title, Description.
7. Создать модель `Invoice` с полями Id, InvoiceNumber, Amount.
8. Создать модель `Library` с полями Id, Name, Address.
9. Создать модель `Book` с полями Id, Title, Author.
10. Создать модель `Employee` с полями Id, Name, Salary.
11. Создать модель `Department` с полями Id, Name.
12. Создать модель `Project` с полями Id, Name, StartDate.
13. Создать модель `User` с полями Id, Username, Password.
14. Создать модель `Profile` с полями Id, Bio, UserId.
15. Создать модель `ProductCategory` с полями Id, Name.

---

## Критерии оценки

| Оценка | Критерий                                                                                                                     |
| ------ | ---------------------------------------------------------------------------------------------------------------------------- |
| 5      | Полное выполнение задания, корректная реализация модели, CRUD работает, структура проекта соблюдена, есть скриншоты и readme |
| 4      | Задание выполнено с незначительными недочетами, CRUD работает частично, есть readme и скриншоты                              |
| 3      | Работа выполнена, но есть ошибки или отсутствуют элементы (скриншоты или readme)                                             |
| 2      | Работа выполнена частично, CRUD не работает, нет readme или скриншотов                                                       |
| 1      | Работа не сдана или проект не запускается                                                                                    |

---

## Контрольные вопросы

1. Что такое модель данных в EF Core?
2. Для чего используется DbContext?
3. Чем отличаются Data Annotations и Fluent API?
4. Как создать миграцию и обновить базу данных?
5. Какие CRUD-операции можно выполнять через модели данных?
6. Как реализовать связь один-ко-многим между сущностями?
7. Как сделать поле обязательным с максимальной длиной через Data Annotations?
8. Как настроить индекс уникальности через Fluent API?
9. В чем преимущество использования моделей данных вместо прямых SQL-запросов?
10. Какие файлы должны быть включены в репозиторий при сдаче работы?

---

## Структура репозитория

```
ПрактическаяРабота20/
│
├─ Project/                  # Проект приложения (ConsoleApp, WinForms, ASP.NET Core)
│
├─ images/                   # Скриншоты работы программы
│
└─ readme.md                 # Номер работы, вариант, текст задания, пример кода
```

**Пример readme.md:**

````markdown
# Практическая работа №20
## Тема: Создание моделей данных в EF
### Вариант 5

**Задание:** Создать модель `Student` с полями Id, Name, Age. Реализовать CRUD-операции.

```csharp
public class Student
{
    public int Id { get; set; }
    public string Name { get; set; }
    public int Age { get; set; }
}
````

```csharp
using var context = new AppDbContext();
var student = new Student { Name = "John", Age = 20 };
context.Students.Add(student);
context.SaveChanges();
```

```