# Лекция 17. Введение в ASP.NET Core

Введение в ASP.NET Core: основы разработки веб-приложений на современной платформе Microsoft

## План лекции

1. **Что такое ASP.NET Core и зачем он нужен**

   * История развития ASP.NET
   * Отличия ASP.NET Core от классического ASP.NET
   * Плюсы и возможности ASP.NET Core

2. **Архитектура ASP.NET Core**

   * Конвейер обработки запросов (Middleware)
   * Dependency Injection
   * Концепция Hosting и WebHost
   * Конфигурация и среда выполнения (Configuration и Environment)

3. **Создание первого проекта на ASP.NET Core**

   * Установка инструментов (Visual Studio, .NET SDK)
   * Шаблоны проектов
   * Структура проекта и описание файлов

4. **Контроллеры и маршрутизация**

   * MVC (Model-View-Controller)
   * Контроллеры и действия
   * Маршрутизация и атрибуты маршрутов
   * Примеры работы с маршрутами

5. **Модели и работа с данными**

   * Создание моделей
   * Использование Entity Framework Core
   * CRUD-операции
   * Примеры взаимодействия с базой данных

6. **Представления (Views)**

   * Razor Pages и Razor Views
   * Синтаксис Razor
   * Привязка данных из контроллера
   * Частичные представления и компоненты

7. **Работа с зависимостями и сервисами**

   * Регистрация сервисов
   * Жизненные циклы сервисов (Transient, Scoped, Singleton)
   * Примеры внедрения зависимостей

8. **Конфигурация и настройка приложения**

   * appsettings.json
   * Использование Environment Variables
   * Настройка Logging и Options Pattern

9. **Безопасность в ASP.NET Core**

   * Аутентификация и авторизация
   * Identity Framework
   * Работа с JWT
   * Примеры реализации безопасного API

10. **Резюме и итоги**

11. **Контрольные вопросы**

---

## Подробное содержание лекции

### 1. Что такое ASP.NET Core и зачем он нужен

ASP.NET Core — это современная кроссплатформенная среда для разработки веб-приложений и API, разработанная Microsoft. Она пришла на смену классическому ASP.NET, предлагая более гибкую архитектуру, высокую производительность и поддержку кроссплатформенности.

**История развития:**

* ASP.NET (2002–2016) — основная среда разработки для Windows. Приложения работали только на IIS.
* ASP.NET Core (2016–настоящее время) — полностью переписанная платформа, кроссплатформенная, работает на Windows, Linux и macOS.

**Основные отличия от классического ASP.NET:**

* Кроссплатформенность.
* Легковесный конвейер Middleware вместо сложного HttpModule/HttpHandler.
* Встроенный Dependency Injection.
* Модульная архитектура и высокая производительность.

**Плюсы ASP.NET Core:**

* Легкая интеграция с современными фронтенд-технологиями (React, Angular, Blazor).
* Поддержка микросервисной архитектуры.
* Высокая масштабируемость и простота тестирования.

**Пример применения:**

* Создание REST API для мобильного приложения.
* Веб-сайты с динамическим контентом.
* Внутренние корпоративные порталы.

---

### 2. Архитектура ASP.NET Core

**Middleware (конвейер обработки запросов)**
В ASP.NET Core каждое HTTP-запрос проходит через цепочку Middleware — модулей, которые могут обрабатывать или перенаправлять запрос.

Пример Middleware: логирование запросов, проверка авторизации, обработка статических файлов.

**Dependency Injection (DI)**
DI встроен по умолчанию. Это значит, что сервисы (например, доступ к базе данных) внедряются в классы автоматически через конструктор, что упрощает тестирование и архитектуру приложения.

**Hosting и WebHost**

* `IHost` и `WebHost` управляют жизненным циклом приложения.
* WebHost отвечает за конфигурацию сервера и запуск приложения.

**Конфигурация и Environment**

* ASP.NET Core поддерживает конфигурацию из разных источников: JSON-файлы, переменные окружения, аргументы командной строки.
* Environment (разработка, тестирование, продакшн) позволяет гибко менять поведение приложения.

---

### 3. Создание первого проекта на ASP.NET Core

**Установка инструментов:**

* .NET SDK с официального сайта.
* Visual Studio или VS Code.

**Шаблоны проектов:**

* Web API
* MVC
* Razor Pages

**Структура проекта:**

* `Program.cs` — основной файл для запуска приложения.
* `Startup.cs` — конфигурация сервисов и Middleware (в .NET 6+ часто объединено с Program.cs).
* `Controllers/` — папка с контроллерами.
* `Views/` — папка с представлениями.
* `wwwroot/` — статические файлы (CSS, JS, изображения).

**Пример кода Program.cs:**

```csharp
var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();

app.MapGet("/", () => "Hello World!");

app.Run();
```

---

### 4. Контроллеры и маршрутизация

**MVC (Model-View-Controller)**

* Model — данные приложения.
* View — представление данных.
* Controller — логика обработки запросов.

**Контроллеры и действия:**

```csharp
public class HomeController : Controller
{
    public IActionResult Index()
    {
        return View();
    }
}
```

**Маршрутизация:**

* Conventional Routing (`{controller=Home}/{action=Index}/{id?}`)
* Attribute Routing (`[Route("products/{id}")]`)

**Пример:**

```csharp
[Route("products")]
public class ProductsController : Controller
{
    [HttpGet("{id}")]
    public IActionResult Details(int id)
    {
        return Content($"Product ID: {id}");
    }
}
```

---

### 5. Модели и работа с данными

**Создание моделей:**

```csharp
public class Product
{
    public int Id { get; set; }
    public string Name { get; set; }
    public decimal Price { get; set; }
}
```

**Entity Framework Core:**

* ORM для работы с базой данных.
* Поддерживает Code First и Database First подходы.

**CRUD-операции:**

```csharp
context.Products.Add(new Product { Name = "Book", Price = 9.99m });
context.SaveChanges();
```

**Пример получения данных:**

```csharp
var product = context.Products.FirstOrDefault(p => p.Id == 1);
```

---

### 6. Представления (Views)

**Razor Pages и Views**

* Razor — синтаксис, который позволяет смешивать C# и HTML.

**Пример Razor View:**

```html
<h1>@Model.Name</h1>
<p>Price: @Model.Price</p>
```

**Частичные представления и компоненты:**

* Используются для повторно используемых частей интерфейса (например, меню или футер).

---

### 7. Работа с зависимостями и сервисами

**Регистрация сервисов:**

```csharp
builder.Services.AddScoped<IProductService, ProductService>();
```

**Жизненные циклы сервисов:**

* Transient — создается каждый раз.
* Scoped — создается на запрос.
* Singleton — создается один раз.

**Пример внедрения зависимости:**

```csharp
public class ProductsController : Controller
{
    private readonly IProductService _service;
    public ProductsController(IProductService service)
    {
        _service = service;
    }
}
```

---

### 8. Конфигурация и настройка приложения

**appsettings.json:**

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=.;Database=MyDb;Trusted_Connection=True;"
  }
}
```

**Использование Options Pattern:**

```csharp
services.Configure<MySettings>(Configuration.GetSection("MySettings"));
```

**Logging:**

* Встроенные логгеры для Console, Debug, File и других провайдеров.

---

### 9. Безопасность в ASP.NET Core

**Аутентификация и авторизация:**

* Cookie Authentication
* JWT для API

**Identity Framework:**

* Управление пользователями, ролями, регистрацией и входом.

**Пример JWT аутентификации:**

```csharp
services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddJwtBearer(options => { /* настройка */ });
```

---

### 10. Резюме

* ASP.NET Core — современная кроссплатформенная среда.
* Архитектура строится на Middleware и DI.
* MVC и Razor обеспечивают разделение данных, логики и представления.
* Entity Framework Core позволяет работать с данными через ORM.
* Встроенная поддержка безопасности и конфигурации упрощает разработку профессиональных приложений.

---

### 11. Контрольные вопросы

1. Чем ASP.NET Core отличается от классического ASP.NET?
2. Что такое Middleware и как он работает?
3. Какие жизненные циклы сервисов существуют в DI?
4. Как настроить подключение к базе данных через Entity Framework Core?
5. В чем различие между Conventional Routing и Attribute Routing?
6. Какие способы аутентификации поддерживает ASP.NET Core?
7. Для чего используется Razor и чем он отличается от обычного HTML?