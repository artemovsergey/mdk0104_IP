# Лекция 24. Типы архитектур приложений в .NET: монолит, модульный монолит, микросервисы

Типы архитектур приложений: монолит, модульный монолит и микросервисы. Отличия, преимущества и сценарии применения в .NET

---

## План лекции

1. **Введение в архитектурные типы**

   * Роль архитектуры в разработке
   * Почему важно выбирать правильный тип архитектуры

2. **Монолитная архитектура**

   * Определение и структура
   * Преимущества и недостатки
   * Примеры реализации на .NET

3. **Модульный монолит**

   * Определение и отличие от классического монолита
   * Разделение на модули
   * Примеры модульного монолита на .NET

4. **Микросервисная архитектура**

   * Принципы и структура
   * Преимущества и недостатки
   * Примеры микросервисов на ASP.NET Core

5. **Сравнение архитектур**

   * Масштабируемость, сложность и поддержка
   * Показатели развертывания и взаимодействия

6. **Выбор архитектуры для проекта**

   * Критерии выбора
   * Практические рекомендации

7. **Резюме и выводы**

8. **Контрольные вопросы**

---

## Подробное содержание лекции

### 1. Введение в архитектурные типы

Архитектура определяет **структуру приложения, взаимодействие компонентов и способы масштабирования**.

Выбор архитектуры влияет на:

* Масштабируемость
* Простоту разработки и поддержки
* Тестируемость
* Скорость развертывания

**Пример:**

* Малое приложение для внутреннего использования → монолит
* Корпоративное приложение с большим числом пользователей → модульный монолит или микросервисы

---

### 2. Монолитная архитектура

**Определение:**
Все компоненты приложения объединены в один проект и развертываются вместе.

**Структура:**

* UI + бизнес-логика + доступ к данным в одном проекте

**Пример на .NET:**

* ASP.NET Core MVC приложение с контроллерами, сервисами и репозиториями в одном проекте

```csharp
// Контроллер и сервис в одном проекте
public class ProductsController : ControllerBase
{
    private readonly ProductService _service;
    public ProductsController(ProductService service) => _service = service;

    public IActionResult Get() => Ok(_service.GetAll());
}
```

**Плюсы:**

* Простота разработки и развертывания
* Легко начать проект

**Минусы:**

* Сложность масштабирования отдельных компонентов
* Любое изменение требует пересборки всего приложения
* Высокая связность

---

### 3. Модульный монолит

**Определение:**

* Все компоненты всё ещё развертываются как единый проект
* При этом приложение логически разделено на независимые **модули**

**Пример разделения на модули:**

1. `UserModule` — управление пользователями
2. `OrderModule` — обработка заказов
3. `ProductModule` — управление продуктами

**Пример структуры на .NET:**

```
MyApp
 ├── Modules
 │    ├── UserModule
 │    ├── OrderModule
 │    └── ProductModule
 └── MyApp.sln
```

**Преимущества модульного монолита:**

* Логическая изоляция компонентов
* Проще тестировать отдельные модули
* Меньше проблем с развертыванием, чем у микросервисов

**Недостатки:**

* Масштабирование всё ещё ограничено единой сборкой
* Зависимости между модулями нужно контролировать

**Пример кода модуля:**

```csharp
// UserModule
public class UserService
{
    public User GetUser(int id) => new User { Id = id, Name = "John" };
}
```

**Использование в контроллере:**

```csharp
[ApiController]
[Route("api/users")]
public class UserController : ControllerBase
{
    private readonly UserService _service;
    public UserController(UserService service) => _service = service;

    [HttpGet("{id}")]
    public IActionResult GetUser(int id) => Ok(_service.GetUser(id));
}
```

---

### 4. Микросервисная архитектура

**Определение:**

* Приложение состоит из небольших **независимых сервисов**, которые взаимодействуют через API или события

**Структура:**

* Каждый микросервис имеет собственную базу данных и развертывается отдельно
* Коммуникация через REST, gRPC, или брокеры событий (RabbitMQ/Kafka)

**Пример микросервисов на .NET:**

1. `UserService` — отдельный проект ASP.NET Core Web API
2. `OrderService` — отдельный проект
3. `ProductService` — отдельный проект

**Пример взаимодействия через HTTP:**

```csharp
// OrderService вызывает UserService для проверки пользователя
var user = await _httpClient.GetFromJsonAsync<User>($"http://userservice/api/users/{userId}");
```

**Преимущества микросервисов:**

* Независимое развертывание
* Масштабирование отдельных сервисов
* Гибкость в выборе технологий для каждого сервиса

**Недостатки:**

* Сложная инфраструктура
* Необходимость мониторинга и логирования
* Сложность тестирования и отладки

---

### 5. Сравнение архитектур

| Тип архитектуры   | Масштабируемость | Сложность | Развертывание | Связность |
| ----------------- | ---------------- | --------- | ------------- | --------- |
| Монолит           | Низкая           | Простая   | Простое       | Высокая   |
| Модульный монолит | Средняя          | Средняя   | Простое       | Средняя   |
| Микросервисы      | Высокая          | Сложная   | Независимое   | Низкая    |

**Ключевые выводы:**

* Монолит — быстро начать и просто развернуть, но сложно масштабировать
* Модульный монолит — логическая изоляция без сложной инфраструктуры
* Микросервисы — для крупных систем с высокой нагрузкой и командной разработкой

---

### 6. Выбор архитектуры для проекта

**Критерии выбора:**

1. Размер команды и навыки
2. Ожидаемая нагрузка и масштабируемость
3. Требования к независимому развертыванию
4. Сложность интеграции с внешними системами
5. Необходимость гибкости в технологиях

**Практические рекомендации:**

* Малый проект или MVP → монолит
* Средний проект с несколькими командами → модульный монолит
* Крупное распределённое приложение → микросервисы

---

### 7. Резюме

* **Монолит:** единый проект, простой старт, высокая связность
* **Модульный монолит:** логическое разделение, проще тестировать, масштабирование ограничено
* **Микросервисы:** независимые сервисы, высокая масштабируемость, сложная инфраструктура
* Выбор архитектуры зависит от размера проекта, команды и требований к масштабируемости и гибкости

---

### 8. Контрольные вопросы

1. В чем отличие монолита от модульного монолита?
2. Какие преимущества микросервисной архитектуры перед монолитом?
3. Когда лучше использовать модульный монолит?
4. Как микросервисы взаимодействуют между собой?
5. Какие критерии выбора архитектуры для нового проекта?
6. Какие сложности возникают при переходе от монолита к микросервисам?
7. Приведите пример структуры проекта для модульного монолита на .NET.
