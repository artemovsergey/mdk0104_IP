# Лекция 25. Развертывание приложения в .NET

Развертывание приложений в .NET: стратегии, инструменты и практические примеры для веб-приложений и API

## План лекции

1. **Введение в развертывание приложений**

   * Что такое развертывание
   * Зачем важно правильно развертывать приложение
   * Основные задачи развертывания

2. **Типы развертывания в .NET**

   * Развертывание на Windows
   * Развертывание на Linux
   * Развертывание в контейнерах (Docker)
   * Развертывание в облаке (Azure, AWS, GCP)

3. **Подготовка приложения к развертыванию**

   * Настройка конфигурации (appsettings, Environment Variables)
   * Публикация проекта
   * Управление зависимостями

4. **Развертывание веб-приложений на IIS**

   * Установка и настройка IIS
   * Публикация через Visual Studio
   * Конфигурация пула приложений

5. **Развертывание на Linux с использованием Nginx или Apache**

   * Настройка Kestrel
   * Реверс-прокси через Nginx
   * Системные сервисы и автозагрузка

6. **Контейнеризация приложения с Docker**

   * Создание Dockerfile
   * Сборка и запуск контейнера
   * Примеры работы с Docker Compose

7. **Облачное развертывание**

   * Azure App Service и Azure Container Instances
   * AWS Elastic Beanstalk и ECS
   * Настройка CI/CD с GitHub Actions или Azure DevOps

8. **Мониторинг и поддержка развернутого приложения**

   * Логирование и трассировка
   * Метрики и оповещения
   * Горячие обновления и откат

9. **Резюме и выводы**

10. **Контрольные вопросы**

---

## Подробное содержание лекции

### 1. Введение в развертывание приложений

**Развертывание (Deployment)** — это процесс переноса приложения из среды разработки в рабочую среду, где оно будет использоваться конечными пользователями.

**Основные задачи развертывания:**

* Подготовка приложения к работе в продакшене
* Настройка конфигураций и секретов
* Настройка сервера или облачной инфраструктуры
* Обеспечение безопасности и масштабируемости

**Пример:**

* ASP.NET Core приложение разработано локально → развертывается на сервере IIS или в Docker контейнере → доступно по URL для пользователей

---

### 2. Типы развертывания в .NET

1. **Windows** — классический вариант с IIS
2. **Linux** — Kestrel + Nginx/Apache
3. **Контейнеры (Docker)** — легковесные изолированные окружения
4. **Облако** — Azure, AWS, GCP, поддержка CI/CD

Каждый тип имеет свои особенности и требует правильной настройки конфигурации и окружения.

---

### 3. Подготовка приложения к развертыванию

**Конфигурация:**

* appsettings.json и appsettings.Production.json
* Переменные окружения (`ASPNETCORE_ENVIRONMENT=Production`)

**Публикация проекта:**

* Через Visual Studio (`Publish`)
* Через CLI:

```bash
dotnet publish -c Release -o ./publish
```

**Управление зависимостями:**

* NuGet пакеты
* Runtime-dependent и self-contained публикации

---

### 4. Развертывание веб-приложений на IIS

**Шаги:**

1. Установить IIS и необходимые компоненты (`ASP.NET Core Hosting Bundle`)
2. Создать сайт в IIS и указать путь к папке с опубликованным приложением
3. Настроить пул приложений (Application Pool) на .NET Core
4. Настроить права доступа и HTTPS

**Пример публикации через Visual Studio:**

* Щелкнуть правой кнопкой → Publish → IIS
* Настроить профиль публикации → выбрать локальный или удаленный сервер

---

### 5. Развертывание на Linux с использованием Nginx

**Kestrel:** встроенный веб-сервер ASP.NET Core, который обрабатывает HTTP-запросы
**Nginx/Apache:** реверс-прокси для обработки HTTPS, балансировки нагрузки

**Пример настройки службы systemd для автозапуска:**

```ini
[Unit]
Description=My ASP.NET Core App
After=network.target

[Service]
WorkingDirectory=/var/www/myapp
ExecStart=/usr/bin/dotnet /var/www/myapp/MyApp.dll
Restart=always
RestartSec=10
SyslogIdentifier=myapp
User=www-data
Environment=ASPNETCORE_ENVIRONMENT=Production

[Install]
WantedBy=multi-user.target
```

**Nginx конфигурация:**

```nginx
server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection keep-alive;
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

---

### 6. Контейнеризация приложения с Docker

**Dockerfile для ASP.NET Core приложения:**

```dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:7.0 AS base
WORKDIR /app
EXPOSE 80

FROM mcr.microsoft.com/dotnet/sdk:7.0 AS build
WORKDIR /src
COPY . .
RUN dotnet publish -c Release -o /app/publish

FROM base AS final
WORKDIR /app
COPY --from=build /app/publish .
ENTRYPOINT ["dotnet", "MyApp.dll"]
```

**Сборка и запуск контейнера:**

```bash
docker build -t myapp .
docker run -d -p 8080:80 myapp
```

**Docker Compose пример:**

```yaml
version: '3.4'
services:
  myapp:
    image: myapp
    ports:
      - "8080:80"
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
```

---

### 7. Облачное развертывание

**Azure App Service:**

* Развертывание через GitHub Actions, Visual Studio или Azure CLI
* Поддержка Linux и Windows контейнеров

**AWS Elastic Beanstalk:**

* Автоматическое создание среды
* Поддержка контейнеров и стандартных веб-приложений

**CI/CD:**

* Автоматическая сборка и развертывание
* Тестирование перед публикацией
* Примеры: GitHub Actions, Azure DevOps pipelines

---

### 8. Мониторинг и поддержка развернутого приложения

**Логирование:**

* Serilog, NLog, Microsoft.Extensions.Logging

**Метрики и оповещения:**

* Application Insights
* Prometheus + Grafana

**Горячие обновления и откат:**

* Blue/Green Deployment
* Canary Releases

---

### 9. Резюме

* Развертывание приложения — ключевой этап жизненного цикла
* В .NET приложения можно развертывать на Windows, Linux, в контейнерах или облаке
* Контейнеризация упрощает переносимость и масштабирование
* CI/CD обеспечивает автоматизацию развертывания и обновлений
* Мониторинг и логирование важны для поддержки стабильности приложения

---

### 10. Контрольные вопросы

1. Что такое развертывание приложения и зачем оно нужно?
2. Какие способы развертывания поддерживаются в .NET?
3. Чем отличается развертывание на Windows и Linux?
4. Что такое Docker и зачем контейнеризировать приложение?
5. Как настроить реверс-прокси для ASP.NET Core приложения на Linux?
6. Какие инструменты CI/CD можно использовать для развертывания приложений?
7. Почему важен мониторинг и логирование развернутого приложения?