# Практическая работа 31. Валидация. FluentValidation

Реализация валидации данных в ASP.NET Core с использованием FluentValidation

## Цель работы

* Ознакомиться с концепцией валидации данных в ASP.NET Core.
* Научиться использовать FluentValidation для проверки моделей.
* Реализовать валидацию форм и API с отображением сообщений об ошибках.
* Получить практические навыки интеграции FluentValidation в MVC, Razor Pages или API.

---

## Теоретическая часть

### 1. Что такое FluentValidation

FluentValidation — библиотека для .NET, позволяющая определять правила валидации моделей через Fluent API (цепочку методов).

**Преимущества FluentValidation:**

* Читаемый и компактный код правил.
* Возможность переиспользования валидаторов.
* Поддержка кастомных правил.
* Легкая интеграция с ASP.NET Core MVC и API.

### 2. Принцип работы

1. Создается валидатор для модели, наследующий `AbstractValidator<T>`.
2. В валидаторе описываются правила для каждого свойства модели.
3. ASP.NET Core автоматически применяет валидатор при обработке форм или API-запросов.
4. В случае нарушения правил возвращается список ошибок.

**Пример правил:**

```csharp
public class UserValidator : AbstractValidator<User>
{
    public UserValidator()
    {
        RuleFor(u => u.Username).NotEmpty().WithMessage("Имя пользователя не должно быть пустым");
        RuleFor(u => u.Email).NotEmpty().EmailAddress().WithMessage("Неверный формат email");
        RuleFor(u => u.Password).MinimumLength(6).WithMessage("Пароль должен быть не менее 6 символов");
    }
}
```

---

## Ход работы

1. Создать новый проект ASP.NET Core (MVC, Razor Pages или Web API).
2. Установить FluentValidation через NuGet:

```bash
dotnet add package FluentValidation.AspNetCore
```

3. Добавить сервис FluentValidation в `Program.cs`:

```csharp
builder.Services.AddControllersWithViews().AddFluentValidation(fv => 
    fv.RegisterValidatorsFromAssemblyContaining<UserValidator>());
```

4. Создать модель данных (например, `User`).
5. Создать валидатор модели, наследуя `AbstractValidator<User>`.
6. Добавить формы или API контроллеры для ввода данных.
7. Проверить работу валидации через формы или Postman.
8. Сделать скриншоты работы приложения с корректными и некорректными данными.
9. Создать репозиторий:

   * Проект приложения
   * Папка `images` с скриншотами
   * `README.md` с примером кода и подсветкой синтаксиса

---

## Практический пример

**Модель данных: User.cs**

```csharp
public class User
{
    public string Username { get; set; }
    public string Email { get; set; }
    public string Password { get; set; }
}
```

**Валидатор: UserValidator.cs**

```csharp
using FluentValidation;

public class UserValidator : AbstractValidator<User>
{
    public UserValidator()
    {
        RuleFor(u => u.Username).NotEmpty().WithMessage("Имя пользователя не должно быть пустым");
        RuleFor(u => u.Email).NotEmpty().EmailAddress().WithMessage("Неверный формат email");
        RuleFor(u => u.Password).MinimumLength(6).WithMessage("Пароль должен быть не менее 6 символов");
    }
}
```

**Контроллер: UsersController.cs**

```csharp
using Microsoft.AspNetCore.Mvc;

[ApiController]
[Route("api/[controller]")]
public class UsersController : ControllerBase
{
    [HttpPost("register")]
    public IActionResult Register(User user)
    {
        if (!ModelState.IsValid)
        {
            return BadRequest(ModelState);
        }
        return Ok("Пользователь успешно зарегистрирован");
    }
}
```

---

## Варианты заданий (выбирается по номеру в журнале)

1. Реализовать валидацию модели пользователя (имя, email, пароль).
2. Валидация модели продукта (название не пустое, цена > 0).
3. Валидация формы регистрации с подтверждением пароля.
4. Проверка даты рождения пользователя (не позже текущей даты).
5. Валидация модели заказа (товар, количество > 0, дата заказа).
6. Проверка ввода email и телефона через FluentValidation.
7. Реализовать кастомное правило: длина имени не менее 3 символов.
8. Создать валидацию модели события (название, дата начала и окончания).
9. Проверка формы обратной связи (имя, email, сообщение).
10. Валидация модели статьи (заголовок не пустой, текст > 50 символов).
11. Проверка модели комментария (текст не пустой, автор не пустой).
12. Реализовать валидацию цены продукта на диапазон от 1 до 1000.
13. Проверка уникальности email в памяти (для учебного примера).
14. Валидация модели профиля пользователя (имя, возраст, email).
15. Создать валидатор для формы поиска (текст поиска не пустой).

---

## Критерии оценки

| Балл | Критерий                                                                                                           |
| ---- | ------------------------------------------------------------------------------------------------------------------ |
| 2    | FluentValidation подключен, но правила работают частично                                                           |
| 3    | Основные правила валидации реализованы и работают корректно                                                        |
| 4    | Валидация всех свойств модели с кастомными сообщениями об ошибках, корректная интеграция с контроллером            |
| 5    | Полностью функциональная валидация, использование кастомных правил, обработка ошибок, README с кодом и скриншотами |

---

## Контрольные вопросы

1. Что такое FluentValidation и какие преимущества он дает?
2. Как подключить FluentValidation в ASP.NET Core?
3. Как создаются валидаторы моделей?
4. Какие типы правил можно использовать в FluentValidation?
5. Как интегрировать FluentValidation с MVC или API контроллером?
6. Как кастомизировать сообщения об ошибках в FluentValidation?
7. Как проверить корректность работы валидатора через Postman или форму?

---

## Структура репозитория

```
ПрактическаяРабота_31/
 ├── FluentValidationApp/    # проект ASP.NET Core
 ├── images/                 # скриншоты работы приложения
 │    ├── 1.png
 │    └── 2.png
 └── README.md
```

**Пример README.md:**

````markdown
# Практическая работа №31: Валидация. FluentValidation

## Вариант Y

### Задание
Реализовать валидацию модели пользователя (имя, email, пароль) с использованием FluentValidation.

### Пример кода

```csharp
// Модель
public class User
{
    public string Username { get; set; }
    public string Email { get; set; }
    public string Password { get; set; }
}
````

```csharp
// Валидатор
public class UserValidator : AbstractValidator<User>
{
    public UserValidator()
    {
        RuleFor(u => u.Username).NotEmpty().WithMessage("Имя пользователя не должно быть пустым");
        RuleFor(u => u.Email).NotEmpty().EmailAddress().WithMessage("Неверный формат email");
        RuleFor(u => u.Password).MinimumLength(6).WithMessage("Пароль должен быть не менее 6 символов");
    }
}
```

### Скриншоты

![Валидация](images/1.png)

```
