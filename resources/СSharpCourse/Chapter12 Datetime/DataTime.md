# Работа с датами и временем

## Структура DateTime

Для работы с датами и временем в .NET предназначена структура DateTime. Она представляет дату и время от 00:00:00 1 января 0001 года до 23:59:59 31 декабря 9999 года.

Для создания нового объекта DateTime также можно использовать конструктор. Пустой конструктор создает начальную дату:

```Csharp
DateTime dateTime = new DateTime();
Console.WriteLine(dateTime); // 01.01.0001 0:00:00
```

То есть мы получим минимально возможное значение, которое также можно получить следующим образом:

```Csharp
Console.WriteLine(DateTime.MinValue);
```

Чтобы задать конкретную дату, нужно использовать один из конструкторов, принимающих параметры:

```Csharp
DateTime date1 = new DateTime(2015, 7, 20); // год - месяц - день
Console.WriteLine(date1); // 20.07.2015 0:00:00
```

Установка времени:

```Csharp
DateTime date1 = new DateTime(2015, 7, 20, 18, 30, 25); // год - месяц - день - час - минута - секунда
Console.WriteLine(date1); // 20.07.2015 18:30:25
```

Если необходимо получить текущую время и дату, то можно использовать ряд свойств DateTime:

```Csharp
Console.WriteLine(DateTime.Now);
Console.WriteLine(DateTime.UtcNow);
Console.WriteLine(DateTime.Today);
```

Консольный вывод:

```
20.07.2015 11:43:33
20.07.2015 8:43:33
20.07.2015 0:00:00
```

Свойство DateTime.Now берет текущую дату и время компьютера, DateTime.UtcNow - дата и время относительно времени по Гринвичу (GMT) и DateTime.Today - только текущая дата.

При работе с датами надо учитывать, что по умолчанию для представления дат применяется григорианский календарь. Но что будет, если мы захотим получить день недели для 5 октября 1582 года:

```Csharp
DateTime someDate = new DateTime(1582, 10, 5);
Console.WriteLine(someDate.DayOfWeek);
```

Консоль высветит значение Tuesday, то есть вторник. Однако, как может быть известно из истории, впервые переход с юлианского календаря на григорианский состоялся в октябре 1582 года. Тогда после даты 4 октября (четверг) (еще по юлианскому календарю) сразу перешли к 15 октября (пятница)(уже по григорианскому календарю). Таким образом, фактически выкинули 10 дней. То есть после 4 октября шло 15 октября.

В большинстве случаев данный факт вряд ли как-то повлияет на вычисления, однако при работе с очень давними датами данный аспект следует учитывать.

## Операции с DateTime

Основные операции со структурой DateTime связаны со сложением или вычитанием дат. Например, надо к некоторой дате прибавить или, наоборот, отнять несколько дней.

Для добавления дат используется ряд методов:

- Add(TimeSpan value): добавляет к дате значение TimeSpan

- AddDays(double value): добавляет к текущей дате несколько дней

- AddHours(double value): добавляет к текущей дате несколько часов

- AddMinutes(double value): добавляет к текущей дате несколько минут

- AddMonths(int value): добавляет к текущей дате несколько месяцев

- AddYears(int value): добавляет к текущей дате несколько лет

Например, добавим к некоторой дате 3 часа:

```Csharp
DateTime date1 = new DateTime(2015, 7, 20, 18, 30, 25); // 20.07.2015 18:30:25
Console.WriteLine(date1.AddHours(3)); // 20.07.2015 21:30:25
```
Для вычитания дат используется метод Subtract(DateTime date):

```Csharp
DateTime date1 = new DateTime(2015, 7, 20, 18, 30, 25); // 20.07.2015 18:30:25
DateTime date2 = new DateTime(2015, 7, 20, 15, 30, 25); // 20.07.2015 15:30:25
Console.WriteLine(date1.Subtract(date2)); // 03:00:00
```

Здесь даты различаются на три часа, поэтому результатом будет дата "03:00:00".

Метод Substract не имеет возможностей для отдельного вычитания дней, часов и так далее. Но это и не надо, так как мы можем передавать в метод AddDays() и другие методы добавления отрицательные значения:

```Csharp
// вычтем три часа
DateTime date1 = new DateTime(2015, 7, 20, 18, 30, 25);  // 20.07.2015 18:30:25
Console.WriteLine(date1.AddHours(-3)); // 20.07.2015 15:30:25
```

Кроме операций сложения и вычитания еще есть ряд методов форматирования дат:

```Csharp
DateTime date1 = new DateTime(2015, 7, 20, 18, 30, 25);
Console.WriteLine(date1.ToLocalTime()); // 20.07.2015 21:30:25
Console.WriteLine(date1.ToUniversalTime()); // 20.07.2015 15:30:25
Console.WriteLine(date1.ToLongDateString()); // 20 июля 2015 г.
Console.WriteLine(date1.ToShortDateString()); // 20.07.2015
Console.WriteLine(date1.ToLongTimeString()); // 18:30:25
Console.WriteLine(date1.ToShortTimeString()); // 18:30
```

Метод ToLocalTime() преобразует время UTC в локальное время, добавляя смещение относительно времени по Гринвичу. Метод ToUniversalTime(), наоборот, преобразует локальное время во время UTC, то есть вычитает смещение относительно времени по Гринвичу. Остальные методы преобразуют дату к определенному формату.

# Форматирование дат и времени

Для форматирования вывода дат и времени применяется ряд строковых форматов:

Описатель

Описание

D

Полный формат даты. Например, 17 июля 2015 г.

d

Краткий формат даты. Например, 17.07.2015

F

Полный формат даты и времени. Например, 17 июля 2015 г. 17:04:43

f

Полный формат даты и краткий формат времени. Например, 17 июля 2015 г. 17:04

G

Краткий формат даты и полный формат времени. Например, 17.07.2015 17:04:43

g

Краткий формат даты и времени. Например, 17.07.2015 17:04

M, m

Формат дней месяца. Например, 17 июля

O, o

Формат обратного преобразования даты и времени. Вывод даты и времени в соответствии со стандартом ISO 8601 в формате "yyyy'-'MM'-'dd'T'HH':'mm':'ss'.'fffffffzzz". Например, 2015-07-17T17:04:43.4092892+03:00

R, r

Время по Гринвичу. Например, Fri, 17 Jul 2015 17:04:43 GMT

s

Сортируемый формат даты и времени. Например, 2015-07-17T17:04:43

T

Полный формат времени. Например, 17:04:43

t

Краткий формат времени. Например, 17:04

U

Полный универсальный полный формат даты и времени. Например, 17 июля 2015 г. 17:04:43

u

Краткий универсальный полный формат даты и времени. Например, 2015-07-17 17:04:43Z

Y, y

Формат года. Например, Июль 2015

Выведем текущею дату и время во всех форматах:

```Csharp
DateTime now = DateTime.Now;
 
Console.WriteLine($"D: {now.ToString("D")}");
Console.WriteLine($"d: {now.ToString("d")}");
Console.WriteLine($"F: {now.ToString("F")}");
Console.WriteLine($"f: {now:f}");
Console.WriteLine($"G: {now:G}");
Console.WriteLine($"g: {now:g}");
Console.WriteLine($"M: {now:M}");
Console.WriteLine($"O: {now:O}");
Console.WriteLine($"o: {now:o}");
Console.WriteLine($"R: {now:R}");
Console.WriteLine($"s: {now:s}");
Console.WriteLine($"T: {now:T}");
Console.WriteLine($"t: {now:t}");
Console.WriteLine($"U: {now:U}");
Console.WriteLine($"u: {now:u}");
Console.WriteLine($"Y: {now:Y}");
```

Консольный вывод:

```
D: 6 января 2022 г.
d: 06.01.2022
F: 6 января 2022 г. 14:45:20
f: 6 января 2022 г. 14:45
G: 06.01.2022 14:45:20
g: 06.01.2022 14:45
M: 6 января
O: 2022-01-06T14:45:20.3942344+04:00
o: 2022-01-06T14:45:20.3942344+04:00
R: Thu, 06 Jan 2022 14:45:20 GMT
s: 2022-01-06T14:45:20
T: 14:45:20
t: 14:45
U: 6 января 2022 г. 10:45:20
u: 2022-01-06 14:45:20Z
Y: январь 2022 г.
```

## Настройка формата времени и даты

Не всегда удобно использование встроенных форматов даты и времени. Иногда бывает необходимо задать сообственную форму отображения объекта DateTime. В этом случае мы можем составить свой формат из описателей:

Описатель

Описание

d

Представляет день месяца от 1 до 31. Одноразрядные числа используются без нуля в начале

dd

Представляет день месяца от 1 до 31. К одноразрядным числам в начале добавляется ноль

ddd

Сокращенное название дня недели

dddd

Полное название дня недели

f / fffffff

Представляет миллисекунды. Количество символов f указывает на число разрядов в миллисекундах

g

Представляет период или эру (например, "н. э.")

h

Часы в виде от 1 до 12. Часы с одной цифрой не дополняются нулем

hh

Часы в виде от 01 до 12. Часы с одной цифрой дополняются нулем

H

Часы в виде от 0 до 23. Часы с одной цифрой не дополняются нулем

HH

Часы в виде от 0 до 23. Часы с одной цифрой дополняются нулем

K

Часовой пояс

m

Минуты от 0 до 59. Минуты с одной цифрой не дополняются начальным нулем

mm

Минуты от 0 до 59. Минуты с одной цифрой дополняются начальным нулем

M

Месяц в виде от 1 до 12

MM

Месяц в виде от 1 до 12. Месяц с одной цифрой дополняется начальным нулем

MMM

Сокращенное название месяца

MMMM

Полное название месяца

s

Секунды в виде числа от 0 до 59. Секунды с одной цифрой не дополняются начальным нулем

ss

Секунды в виде числа от 0 до 59. Секунды с одной цифрой дополняются начальным нулем

t

Первые символы в обозначениях AM и PM

tt

AM или PM

y

Представляет год как число из одной или двух цифр. Если год имеет более двух цифр, то в результате отображаются только две младшие цифры

yy

Представляет год как число из одной или двух цифр. Если год имеет более двух цифр, то в результате отображаются только две младшие цифры. Если год имеет одну цифру, то он дополняется начальным нулем

yyy

Год из трех цифр

yyyy

Год из четырех цифр

yyyyy

Год из пяти цифр. Если в году меньше пяти цифр, то он дополняется начальными нулями

z

Представляет смещение в часах относительно времени UTC

zz

Представляет смещение в часах относительно времени UTC. Если смещение представляет одну цифру, то она дополняется начальным нулем.

Создадим пару своих форматов:

```Csharp
DateTime now = DateTime.Now;
Console.WriteLine(now.ToString("hh:mm:ss"));
Console.WriteLine(now.ToString("dd.MM.yyyy"));
```

Консольный вывод:

```Csharp
02:46:38
06.01.2022
```

# DateOnly и TimeOnly

Для упрощения работы с датами и временем в .NET 6 были добавлены две дополнительные структуры - DateOnly и TimeOnly.

DateOnly
Структура DateOnly представляет дату. Для создания структуры можно использовать ряд ее конструкторов.

```Csharp
DateOnly()
DateOnly(int year, int month, int day)
DateOnly(int year, int month, int day, System.Globalization.Calendar calendar)
```

При использовании конструктора без параметров структура инициализируется датой 01.01.0001:

```Csharp
DateOnly someDate = new DateOnly();
Console.WriteLine(someDate); // 01.01.0001
```

Вторая версия конструктора принимает год, месяц и число, которыми инициализируется структура:

```Csharp
DateOnly someDate = new DateOnly(2022,1,6); // 6 января 2022 года
Console.WriteLine(someDate); // 06.01.2022
```

Третья версия конструктора в дополнение к году, месяцу и числу, также принимает объект календаря - объект System.Globalization.Calendar, относительно которого будет расcчитываться дата. Класс Calendar является абстрактным, но .NET предоставляет ряд встроенных типов календарей. Например, расcчитаем дату относительно юлианского календаря:

```Csharp
using System.Globalization;
 
DateOnly julianDate = new DateOnly(2022,1,6, new JulianCalendar());
Console.WriteLine(julianDate); // 19.01.2022
```

В данном случае для .NET переданная в конструктор дата - 06.01.2022 расценивается как дата юлианского календаря. При выводе на консоль мы видим тот же день только относительно григорианского календаря.

## Свойства DateOnly

С помощью свойств структуры можно получить отдельные составляющие даты:

- Day: возвращает день даты

- DayNumber: возвращает количество прошедших дней с 1 января 0001 года относительно григорианского календаря

- DayOfWeek: возвращает день недели

- DayOfYear: возвращает день года

- MaxValue: возвращает максимально возможную дату (статическое свойство)

- MinValue: возвращает самую раннюю возможную дату (статическое свойство)

- Month: возвращает месяц

- Year: возвращает год

Применение свойств:

```Csharp
DateOnly now = new DateOnly(2022,1,6);
Console.WriteLine(now.Day);         // 6
Console.WriteLine(now.DayNumber);   // 738160
Console.WriteLine(now.DayOfWeek);   // Thursday
Console.WriteLine(now.DayOfYear);   // 6
Console.WriteLine(now.Month);       // 1
Console.WriteLine(now.Year);        // 2022
```

## Методы DateOnly

С помощью методов DateOnly можно производить некоторые операции с датами. Некоторые из них:

- AddDays(int days): добавляет к дате некоторое количество дней

- AddMonths(int months): добавляет к дате некоторое количество месяцев

- AddYears(int years): добавляет к дате некоторое количество лет

- ToDateTime(TimeOnly): возвращает объект DateTime, который в качестве даты исппользует текущий объект DateOnly, а в качестве времени - значение параметра в виде TimeOnly

- ToLongDateString(): выводит текущий объект DateOnly в виде подробной даты

- ToShortDateString(): выводит текущий объект DateOnly в виде сжатой даты

Также в классе есть ряд статических методов. Некоторые из них:

- FromDateTime(DateTime dateTime): на основе значения DateTime, переданного через параметр, создает и возвращает объект DateOnly

- FromDayNumber(int days): на основе количества дней создает и возвращает объект DateOnly

- Parse(string date): конвертирует строковое представление даты в объект DateOnly

- ParseExact(string date, string format): конвертирует строковое представление даты в объект DateOnly, применяя определенный формат

- TryParse(String, DateOnly): конвертирует строковое представление даты в объект DateOnly. При успешной конвертации возвращает true, а параметр типа DateOnly содержит созданную дату

- TryParseExact(String, String, DateOnly): конвертирует строковое представление даты в объект DateOnly, применяя определенный формат. При успешной конвертации возвращает true, а параметр типа DateOnly содержит созданную дату

Пример некоторых операций:

```Csharp
DateOnly now = DateOnly.Parse("06.01.2022");    // на русскоязычной локализованной ОС
Console.WriteLine(now); // 06.01.2022
now = now.AddDays(1);   // 07.01.2022
now = now.AddMonths(4); // 07.05.2022
now = now.AddYears(-1); // 07.05.2021
Console.WriteLine(now.ToShortDateString());  // 07.05.2021
Console.WriteLine(now.ToLongDateString());   // 7 мая 2021 г.
```

## TimeOnly

Структура TimeOnly представляет время в диапазоне от 00:00:00 до 23:59:59.9999999. Для создания структуры можно использовать ряд ее конструкторов.

```Csharp
TimeOnly()
TimeOnly(long ticks)
TimeOnly(int hour, int minute)
TimeOnly(int hour, int minute, int second)
TimeOnly(int hour, int minute, int second, int millisecond)
```

При использовании конструктора без параметров структура инициализируется временем 0.00:

```Csharp
TimeOnly time = new TimeOnly();
Console.WriteLine(time); // 0:00
```

Дополнительно с помощью других версий конструктора можно установить количество часов, минут, секунд и миллисекунд:

```Csharp
TimeOnly time1 = new TimeOnly(4, 30);
Console.WriteLine(time1);   // 4: 30
 
TimeOnly time2 = new TimeOnly(14, 23, 30);
Console.WriteLine(time2);   // 14: 23
```

## Свойства TimeOnly

С помощью свойств структуры можно получить отдельные составляющие времени:

- Hour: возвращает количество часов

- Minute: возвращает количество минут

- Second: возвращает количество секунд

- Millisecond: возвращает количество миллисекунд

- Ticks: возвращает количество тиков

- MaxValue: возвращает максимально возможное время (статическое свойство)

- MinValue: возвращает минимально возможное время (статическое свойство)

Применение свойств:

```Csharp
TimeOnly time = new TimeOnly(14, 23, 30);
Console.WriteLine(time.Hour);       // 14
Console.WriteLine(time.Minute);     // 23
Console.WriteLine(time.Second);     // 30
```

## Методы TimeOnly

С помощью методов TimeOnly можно производить некоторые операции с временем. Некоторые из них:

- AddHours(double hours): добавляет к времени некоторое количество часов

- AddMinutes(double minutes): добавляет к времени некоторое количество минут

- Add(TimeSpan value): добавляет время из объекта TimeSpan

- ToLongTimeString(): выводит текущий объект TimeOnly в виде подробного времени

- ToShortTimeString(): выводит текущий объект TimeOnly в виде сжатого времени

Также в классе есть ряд статических методов. Некоторые из них:

- FromDateTime(DateTime dateTime): на основе значения DateTime, переданного через параметр, создает и возвращает объект TimeOnly

- FromTimeSpan(TimeSpan value): на основе объекта TimeSpan создает и возвращает объект TimeOnly

- Parse(string time): конвертирует строковое представление времени в объект TimeOnly

- ParseExact(string timee, string format): конвертирует строковое представление времени в объект TimeOnly, применяя определенный формат

- TryParse(string time, TimeOnly result): конвертирует строковое представление времени в объект TimeOnly. При успешной конвертации возвращает true, а параметр типа TimeOnly содержит сконвертированное время

- TryParseExact(string time, string format, TimeOnly result): конвертирует строковое представление времени в объект TimeOnly, применяя определенный формат. При успешной конвертации возвращает true, а параметр типа TimeOnly содержит сконвертированное время

Пример некоторых операций:

```Csharp
TimeOnly time = TimeOnly.Parse("06:33:22");
Console.WriteLine(time);        // 6:33
time = time.AddHours(1);        // 7:33
time = time.AddMinutes(-23);   // 7:10
 
Console.WriteLine(time.ToShortTimeString());  // 7:10
Console.WriteLine(time.ToLongTimeString());   // 7:10:22
```